<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NFL Draft Chain</title>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QWSE9N9Q5F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-QWSE9N9Q5F');
</script>

<style>
body {
    margin:0;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:white;
    text-align:center;
}

.container {
    max-width:900px;
    margin:auto;
    padding:20px;
}

h1 { margin-bottom:5px; }

.card {
    background:rgba(255,255,255,0.08);
    padding:20px;
    border-radius:15px;
    margin:15px 0;
    backdrop-filter: blur(8px);
    transition: all .3s ease;
}

input {
    padding:12px;
    width:60%;
    border-radius:8px;
    border:none;
    font-size:16px;
}

button {
    padding:12px 20px;
    border:none;
    border-radius:8px;
    background:#00d4ff;
    color:black;
    font-weight:bold;
    cursor:pointer;
    margin-left:8px;
}

button:hover { background:#00a6c7; }

#suggestions {
    max-height:150px;
    overflow-y:auto;
    background:#111;
    border-radius:8px;
    margin-top:5px;
}

.suggestion {
    padding:8px;
    cursor:pointer;
}

.suggestion:hover {
    background:#00d4ff;
    color:black;
}

.match { color:#00ff88; }

#timer { font-size:22px; margin-top:10px; }

.fadeIn {
    animation: fade .5s ease;
}

@keyframes fade {
    from { opacity:0; transform:translateY(10px); }
    to { opacity:1; transform:translateY(0); }
}

.toggle {
    cursor:pointer;
    margin-top:10px;
    font-weight:bold;
    color:#00d4ff;
}
</style>
</head>

<body>
<div class="container">

<h1>NFL Draft Chain</h1>

<div class="card">
    <strong>Build the Longest Draft Chain</strong><br>
    Start with the generated college.<br>
    Each new player must match <b>3 of 5:</b><br>
    Team ‚Ä¢ Draft Year ‚Ä¢ Position ‚Ä¢ College ‚Ä¢ Round<br>
    ‚è± 60 seconds per pick ‚Ä¢ üö´ No repeats

    <div class="toggle" onclick="toggleRules()">‚ñº How to Play</div>

    <div id="rules" style="display:none; margin-top:10px; text-align:left;">
        <b>Objective:</b> Create the longest possible draft chain.<br><br>
        <b>Start:</b> First player must match the starting college.<br><br>
        <b>Chain Rule:</b> Each new player must match at least 3 of:
        Team, Draft Year, Position, College, Round.<br>
        Draft Pick is shown but does NOT count.<br><br>
        <b>You Lose If:</b> Fewer than 3 match, repeat a player, or run out of time.<br><br>
        Score = total successful chain length.
    </div>
</div>

<div class="card">
    <div id="startCollege"></div>
    <div id="timer"></div>
</div>

<div class="card">
    <div id="currentPlayer"></div>
</div>

<div class="card">
    <input type="text" id="guessInput" placeholder="Start typing player name...">
    <button onclick="submitGuess()">Submit</button>
    <div id="suggestions"></div>
</div>

<div class="card">
    <div id="feedback"></div>
    <div id="gameOver"></div>
    <div id="streak"></div>
    <button onclick="startGame()">Restart Game</button>
</div>

<div class="card">
    <h3>Best Chain</h3>
    <div id="leaderboard"></div>
</div>

</div>

<script>
let players = [];
let currentPlayer = null;
let streak = 0;
let bestChain = localStorage.getItem("bestChain") || 0;
let firstTurn = true;
let requiredCollege = "";
let usedPlayers = [];
let timerInterval;
let timeLeft = 60;

function toggleRules(){
    const rules = document.getElementById("rules");
    rules.style.display = rules.style.display === "none" ? "block" : "none";
}

fetch("draftplayers.json")
.then(res => res.json())
.then(data => {
    players = data;
    updateLeaderboard();
    startGame();
});

function startGame(){
    streak = 0;
    firstTurn = true;
    usedPlayers = [];
    clearInterval(timerInterval);
    document.getElementById("gameOver").innerText = "";
    document.getElementById("feedback").innerText = "";
    document.getElementById("currentPlayer").innerText = "";
    document.getElementById("guessInput").value = "";
    document.getElementById("suggestions").innerHTML = "";

    const randomPlayer = players[Math.floor(Math.random()*players.length)];
    requiredCollege = randomPlayer.College;

    document.getElementById("startCollege").innerText =
        "Start College: " + requiredCollege;

    startTimer();
}

function startTimer(){
    timeLeft = 60;
    document.getElementById("timer").innerText = "Time: " + timeLeft;
    clearInterval(timerInterval);

    timerInterval = setInterval(()=>{
        timeLeft--;
        document.getElementById("timer").innerText = "Time: " + timeLeft;
        if(timeLeft <= 0){
            clearInterval(timerInterval);
            endGame("Time‚Äôs up! You broke the chain.");
        }
    },1000);
}

document.getElementById("guessInput").addEventListener("input", function(){
    const input = this.value.toLowerCase();
    const suggestions = players
        .filter(p => p.Player.toLowerCase().includes(input) && !usedPlayers.includes(p.Player))
        .slice(0,10);

    const suggestionsDiv = document.getElementById("suggestions");
    suggestionsDiv.innerHTML = "";

    suggestions.forEach(p=>{
        const div = document.createElement("div");
        div.className = "suggestion";
        div.innerText = p.Player;
        div.onclick = ()=>{
            document.getElementById("guessInput").value = p.Player;
            suggestionsDiv.innerHTML = "";
        };
        suggestionsDiv.appendChild(div);
    });
});

function submitGuess(){
    const guess = document.getElementById("guessInput").value.trim();
    const guessedPlayer = players.find(p => p.Player.toLowerCase() === guess.toLowerCase());

    if(!guessedPlayer || usedPlayers.includes(guessedPlayer.Player)){
        document.getElementById("feedback").innerText = "Invalid or already used player.";
        return;
    }

    if(firstTurn){
        if(guessedPlayer.College !== requiredCollege){
            endGame("You broke the chain! Must match starting college.");
            return;
        }
        currentPlayer = guessedPlayer;
        usedPlayers.push(guessedPlayer.Player);
        firstTurn = false;
        streak++;
        displayCurrent();
        startTimer();
        return;
    }

    let matches = 0;
    let breakdown = [];

    if(guessedPlayer.Team === currentPlayer.Team){ matches++; breakdown.push("Team"); }
    if(guessedPlayer.Year === currentPlayer.Year){ matches++; breakdown.push("Year"); }
    if(guessedPlayer.Pos === currentPlayer.Pos){ matches++; breakdown.push("Position"); }
    if(guessedPlayer.College === currentPlayer.College){ matches++; breakdown.push("College"); }
    if(guessedPlayer.Round === currentPlayer.Round){ matches++; breakdown.push("Round"); }

    if(matches >= 3){
        currentPlayer = guessedPlayer;
        usedPlayers.push(guessedPlayer.Player);
        streak++;
        document.getElementById("feedback").innerHTML =
            "Correct! Matched: <span class='match'>" + breakdown.join(", ") + "</span>";
        displayCurrent();
        startTimer();
    } else {
        endGame("You broke the chain! Only " + matches + " matches.");
    }

    document.getElementById("guessInput").value = "";
    document.getElementById("suggestions").innerHTML = "";
}

function displayCurrent(){
    document.getElementById("currentPlayer").innerHTML =
        "<div class='fadeIn'><strong>" + currentPlayer.Player + "</strong><br>" +
        currentPlayer.Pos + " | " +
        currentPlayer.Team + " | Round " +
        currentPlayer.Round + " Pick " +
        currentPlayer.Pick + " | " +
        currentPlayer.Year + " | " +
        currentPlayer.College + "</div>";

    document.getElementById("streak").innerText = "Chain Length: " + streak;
}

function endGame(message){
    clearInterval(timerInterval);
    document.getElementById("gameOver").innerText = message;

    if(streak > bestChain){
        bestChain = streak;
        localStorage.setItem("bestChain", bestChain);
        updateLeaderboard();
    }
}

function updateLeaderboard(){
    document.getElementById("leaderboard").innerText =
        "Best Chain: " + bestChain;
}
</script>

</body>
</html>
